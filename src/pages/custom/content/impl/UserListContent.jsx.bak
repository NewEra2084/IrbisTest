import React, { useEffect, useState, useCallback } from 'react';
import PreloadContent from '../preload/PreloadContent';
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';
import { faGear, faEllipsisH, faBars } from '@fortawesome/free-solid-svg-icons';
import AbstractListView from '@/components/ui/list/AbstractListView';

const initialUsers = [
  {
    id: 'user-1',
    avatar: 'https://i.pravatar.cc/40?img=1',
    username: 'alice123',
    fullName: 'Alice Johnson',
    skills: ['frontend', 'design'],
    status: 'Active',
    role: 'Admin',
  },
  {
    id: 'user-2',
    avatar: 'https://i.pravatar.cc/40?img=2',
    username: 'bob_dev',
    fullName: 'Bob Smith',
    skills: ['backend', 'devops'],
    status: 'Offline',
    role: 'Developer',
  },
  {
    id: 'user-3',
    avatar: 'https://i.pravatar.cc/40?img=3',
    username: 'carol42',
    fullName: 'Carol White',
    skills: ['frontend', 'backend'],
    status: 'Busy',
    role: 'QA',
  },
];

const view = {
    type : "card",
    buttons : []
};

function UserContent({ item }) {
  const user = item;
  return (
    <>
        <img
            src={user.avatar}
            alt={user.fullName}
            className="w-10 h-10 rounded-full object-cover"
          />
        <div>
            <h2 className="font-semibold text-gray-800 dark:text-gray-100">
              {user.fullName}
            </h2>
            <p className="text-gray-600 dark:text-gray-300 text-xs">@{user.username}</p>
            <p className="text-gray-500 dark:text-gray-400 text-xs">Skills: {user.skills.join(', ')}</p>
            <p className="text-gray-500 dark:text-gray-400 text-xs">Role: {user.role}</p>
            <span className="inline-block mt-1 px-2 py-1 text-xs rounded-full bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200">
              {user.status}
            </span>
        </div>
    </>
  );
}


function UserCard({ user }) {

  return (
    <div className="relative bg-white dark:bg-gray-800 p-4 rounded-xl shadow text-sm flex items-start space-x-4">
      {/* Аккуратная кнопка в правом верхнем углу */}
      <button
        className="absolute top-2 right-2 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 hover:text-gray-700 dark:hover:text-gray-200 transition"
        title="More actions"
      >
        <FontAwesomeIcon icon={faEllipsisH} className="w-4 h-4" />
      </button>

      <img
        src={user.avatar}
        alt={user.fullName}
        className="w-10 h-10 rounded-full object-cover"
      />
      <div>
        <h2 className="font-semibold text-gray-800 dark:text-gray-100">
          {user.fullName}
        </h2>
        <p className="text-gray-600 dark:text-gray-300 text-xs">@{user.username}</p>
        <p className="text-gray-500 dark:text-gray-400 text-xs">Skills: {user.skills.join(', ')}</p>
        <p className="text-gray-500 dark:text-gray-400 text-xs">Role: {user.role}</p>
        <span className="inline-block mt-1 px-2 py-1 text-xs rounded-full bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200">
          {user.status}
        </span>
      </div>
    </div>
  );
}

export default function UserListContent() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);

  const fetchUsers = useCallback(async () => {
    setLoading(true);
    try {
      // const res = await fetch('/api/users/list');
      // const result = await res.json();
      const result = initialUsers;
      setUsers(result);
    } catch (err) {
      console.error('Ошибка при загрузке пользователей:', err);
    } finally {
      setLoading(false);
    }
  }, []);

  useEffect(() => {
    fetchUsers();
  }, []);

  if (loading) {
    return <PreloadContent />;
  }

  /*return (
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {users.map((user) => (
        <UserCard key={user.id} user={user} />
      ))}
    </div>
  );*/
  return (
    <AbstractListView type="grid" items={initialUsers} itemView={view} ElementContent={UserContent}/>
  );
}
